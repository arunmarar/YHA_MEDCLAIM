sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/FilterOperator","sap/m/GroupHeaderListItem","sap/ui/Device","sap/ui/core/Fragment","../model/formatter","sap/m/MessageToast","sap/m/MessageBox"],function(e,t,o,r,s,i,a,n,l,d,p){"use strict";var u;return e.extend("Gail.Medical_Claim.controller.Master",{formatter:l,onInit:function(){var e=this.getOwnerComponent().getModel("RouteModel");e.setProperty("/split",true);e.setProperty("/normal",false);var t=this.byId("list"),o=this._createViewModel(),r=t.getBusyIndicatorDelay();this._oList=t;this._oListFilterState={aFilter:[],aSearch:[]};this.setModel(o,"masterView");t.attachEventOnce("updateFinished",function(){o.setProperty("/delay",r)});this.getRouter().getRoute("master").attachPatternMatched(this._onMasterMatched,this);this.getRouter().attachBypassed(this.onBypassed,this)},onUpdateFinished:function(e){this._updateListItemCount(e.getParameter("total"))},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh();return}var t=e.getParameter("query");if(t){this._oListFilterState.aSearch=[new o("Refnr",s.Contains,t)]}else{this._oListFilterState.aSearch=[]}this._applyFilterSearch()},onNavToInitial:function(){var e=this.getOwnerComponent().getModel("buttonsModel");var t=e.getProperty("/process");var o=this;if(t==="Create"){p.information("Changes will be lost..Do you still want to navigate?",{title:"Alert",actions:[p.Action.YES,p.Action.CANCEL],onClose:function(e){if(e==="YES"){o.getOwnerComponent().getModel("detailMasterModel").setData(null);o.getOwnerComponent().getRouter().navTo("initial");var t=o.getOwnerComponent().getModel("buttonsModel");t.setProperty("/mAdd",false);t.setProperty("/mReview",false);o.getModel("appView").setProperty("/layout","OneColumn")}}})}else if(t==="Edit"){p.information("New Changes (if any) will be lost..Do you still want to navigate?",{title:"Alert",actions:[p.Action.YES,p.Action.CANCEL],onClose:function(e){if(e==="YES"){o.getOwnerComponent().getModel("detailMasterModel").setData(null);o.getOwnerComponent().getRouter().navTo("initial");var t=o.getOwnerComponent().getModel("buttonsModel");t.setProperty("/mAdd",false);t.setProperty("/mReview",false);o.getModel("appView").setProperty("/layout","OneColumn")}}})}else{this.getOwnerComponent().getModel("detailMasterModel").setData(null);this.getOwnerComponent().getRouter().navTo("initial");var e=this.getOwnerComponent().getModel("buttonsModel");e.setProperty("/mAdd",false);e.setProperty("/mReview",false)}},onRefresh:function(){this._oList.getBinding("items").refresh()},onRemarks:function(e){var t=this.getOwnerComponent().getModel("buttonsModel");var o=t.getProperty("/headerRemarks");var r=!!this.getView().$().closest(".sapUiSizeCompact").length;p.information(o,{styleClass:r?"sapUiSizeCompact":""})},onConfirmViewSettingsDialog:function(e){this._applySortGroup(e)},_applySortGroup:function(e){var t=e.getParameters(),o,s,i=[];o=t.sortItem.getKey();s=t.sortDescending;i.push(new r(o,s));this._oList.getBinding("items").sort(i)},onSelectionChange:function(e){var t=this.getOwnerComponent().getModel("buttonsModel");var o=t.getProperty("/dSave");if(sap.ui.Device.system.desktop){if(o===true){p.information("You are in Edit Mode. Please Save the changes First");return}}var r=e.getSource(),s=e.getParameter("selected");if(!(r.getMode()==="MultiSelect"&&!s)){this._showDetail(e.getParameter("listItem")||e.getSource())}},onBypassed:function(){this._oList.removeSelections(true)},createGroupHeader:function(e){return new i({title:e.text,upperCase:false})},onNavBack:function(){history.go(-1)},_createViewModel:function(){return new t({isFilterBarVisible:false,filterBarLabel:"",delay:0,title:this.getResourceBundle().getText("masterTitleCount",[0]),noDataText:this.getResourceBundle().getText("masterListNoDataText"),sortBy:"Pernr",groupBy:"None"})},onBeforeRendering:function(){},_onMasterMatched:function(e){var t=this.getOwnerComponent().getModel("RouteModel");t.setProperty("/split",true);t.setProperty("/normal",false);u=e.getParameter("arguments").claimId;if(u=="0"){if(sap.ui.Device.system.desktop){var o=this.getView().byId("list").getItems()[0];this.getView().byId("list").setSelectedItem(o);this._showDetail(o)}}else{u=atob(u);sap.ui.core.BusyIndicator.show(0);var r=this.getOwnerComponent().getModel("InitialModel");var s=this;r.read("/CLAIMS_DETAILSSet('"+u+"')",{urlParameters:{$expand:"TOItem"},success:function(e){s.bindList(e)},error:function(e){sap.ui.core.BusyIndicator.hide();d.show("Error Connecting odata service to backend")}})}},bindList:function(e){var t=this.getOwnerComponent().getModel("detailMasterModel");t.setData(e.TOItem.results);sap.ui.core.BusyIndicator.hide();if(e.Cstat=="N"){var o=this.getOwnerComponent().getModel("buttonsModel");o.setProperty("/mAdd",true);o.setProperty("/mAttach",true);o.setProperty("/mDelete",true);o.setProperty("/mRevoke",false);o.setProperty("/showEdit",true);o.setProperty("/rSaveDraft",true);o.setProperty("/rSubmit",true);o.setProperty("/process","Edit");o.setProperty("/claimId",u)}else if(e.Cstat=="T"){var o=this.getOwnerComponent().getModel("buttonsModel");o.setProperty("/mAdd",false);o.setProperty("/mReview",true);o.setProperty("/mRevoke",true);o.setProperty("/mAttach",false);o.setProperty("/mDelete",false);o.setProperty("/showEdit",false);o.setProperty("/rSaveDraft",false);o.setProperty("/rSubmit",false);o.setProperty("/process","Display");o.setProperty("/claimId",u)}else{var o=this.getOwnerComponent().getModel("buttonsModel");o.setProperty("/mAdd",false);o.setProperty("/mReview",true);o.setProperty("/mRevoke",false);o.setProperty("/mAttach",false);o.setProperty("/mDelete",false);o.setProperty("/showEdit",false);o.setProperty("/rSaveDraft",false);o.setProperty("/rSubmit",false);o.setProperty("/process","Display");o.setProperty("/claimId",u)}if(e.FlagAttach===""){o.setProperty("/count",1);o.setProperty("/prevPdf",false)}else if(e.FlagAttach==="X"){o.setProperty("/count",0);o.setProperty("/prevPdf",true)}if(e.FlagAttachApp===""){o.setProperty("/prevAppPdf",false)}else{o.setProperty("/prevAppPdf",true)}if(e.Remarks!==""){this.getView().byId("remarksButton").setVisible(true);o.setProperty("/headerRemarks",e.Remarks)}else{this.getView().byId("remarksButton").setVisible(false)}o.setProperty("/filesize",e.Fsize);if(sap.ui.Device.system.desktop){this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");var r=this.getView().byId("list").getItems()[0];this.getView().byId("list").setSelectedItem(r);this._showDetail(r)}else{this.getModel("appView").setProperty("/layout","OneColumn")}},_showDetail:function(e){var t=!a.system.phone;var o=e.getBindingContextPath();this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getRouter().navTo("object",{objectId:btoa(o)},t)},onAddM:function(){var e=this.getOwnerComponent().getModel("buttonsModel");var t=!a.system.phone;if(sap.ui.Device.system.desktop){e.setProperty("/mAdd",false)}else{e.setProperty("/mAdd",true)}var o="1";this.getRouter().navTo("object",{objectId:btoa(o)},t)},onDeleteM:function(){var e=this.getView().byId("list").getSelectedContextPaths();e=e.toString();e=e.slice(1);var t=this.getOwnerComponent().getModel("detailMasterModel").oData;var o=t.length;if(o==e||!e){p.information("Please select a record to delete!",{title:"Alert"});return}t.splice(e,1);this.getOwnerComponent().getModel("detailMasterModel").setData(t);if(t.length===0){var r=this.getOwnerComponent().getModel("buttonsModel");r.setProperty("/mDelete",false);r.setProperty("/mAttach",false);this.onAddM()}},_updateListItemCount:function(e){var t;if(this._oList.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("masterTitleCount",[e]);this.getModel("masterView").setProperty("/title",t)}},_applyFilterSearch:function(){var e=this._oListFilterState.aSearch.concat(this._oListFilterState.aFilter),t=this.getModel("masterView");this._oList.getBinding("items").filter(e,"Application");if(e.length!==0){t.setProperty("/noDataText",this.getResourceBundle().getText("masterListNoDataWithFilterOrSearchText"))}else if(this._oListFilterState.aSearch.length>0){t.setProperty("/noDataText",this.getResourceBundle().getText("masterListNoDataText"))}},_updateFilterBar:function(e){var t=this.getModel("masterView");t.setProperty("/isFilterBarVisible",this._oListFilterState.aFilter.length>0);t.setProperty("/filterBarLabel",this.getResourceBundle().getText("masterFilterBarText",[e]))},onReview:function(){this.getOwnerComponent().getRouter().navTo("review")},onAttachment:function(){this.getOwnerComponent().getRouter().navTo("attachment")},onRevoke:function(){sap.ui.core.BusyIndicator.show(0);var e=this.getOwnerComponent().getModel("InitialModel");var t=this;e.read("/Recall_ClaimSet('"+u+"')",{success:function(e){sap.ui.core.BusyIndicator.hide();if(e.Type==="S"){p.success("Claim No. "+u+" has been Recalled Successfully.",{icon:p.Icon.SUCCESS,title:"Success",action:[p.Action.OK],onClose:function(e){t.getOwnerComponent().getRouter().navTo("initial")}})}else{p.error("Claim No. "+u+" cannot be Recall.",{icon:p.Icon.ERROR,title:"Alert",action:[p.Action.OK],onClose:function(e){t.getOwnerComponent().getRouter().navTo("initial")}})}},error:function(e){sap.ui.core.BusyIndicator.hide();d.show("Error Connecting odata service to backend")}})}})});
//# sourceMappingURL=Master-dbg-dbg.controller.js.map